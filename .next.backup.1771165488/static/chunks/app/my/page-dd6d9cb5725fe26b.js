(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{63:(e,r,a)=>{"use strict";var s=a(7260);a.o(s,"useParams")&&a.d(r,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})},1969:(e,r,a)=>{Promise.resolve().then(a.bind(a,5257))},4481:(e,r,a)=>{"use strict";function s(e){var r;let a="string"!=typeof(r=function(e){let r=e.trim(),a=r.lastIndexOf(".");return a<=0?r:r.slice(0,a)}(e))?null:r.replace(/\s+/g," ").trim()||null;return a||"Transcript"}a.d(r,{j:()=>s})},5257:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>m});var s=a(5155),t=a(2115),l=a(6489),d=a(2619),i=a.n(d),n=a(5239),o=a(63),c=a(4481);function m(){var e,r,a;let{data:d,status:m}=(0,l.useSession)(),u=(0,o.useRouter)(),[p,x]=(0,t.useState)([]),[b,h]=(0,t.useState)(!0),[v,f]=(0,t.useState)(""),[g,j]=(0,t.useState)("date"),[N,y]=(0,t.useState)("desc"),[w,S]=(0,t.useState)(null),[k,P]=(0,t.useState)(1),[z,C]=(0,t.useState)(!1);if("loading"===m)return(0,s.jsx)("div",{className:"dashboard-shell min-h-screen text-[var(--text-main)] flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-[var(--border-medium)] border-t-[var(--btn-primary)] mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-[var(--text-muted)]",children:"Loading..."})]})});if("unauthenticated"===m)return u.replace("/auth/signin?callbackUrl=/my"),null;let D=(0,t.useCallback)(async()=>{var e;if(null==d||null==(e=d.user)?void 0:e.id){h(!0),S(null);try{let e=await fetch("/api/podcasts?page=".concat(k,"&pageSize=20&includePrivate=true"));if(!e.ok){if(401===e.status)throw Error("Authentication required. Please sign in again.");throw Error("Failed to fetch podcast list")}let r=(await e.json()).data.map(e=>{var r;return{id:e.id,name:("string"==typeof e.title?e.title.trim():"")||(0,c.j)(String(e.originalFileName||"")),briefSummary:(r=e.briefSummary,"string"!=typeof r?null:r.replace(/#\s*English Summary/gi," ").replace(/#\s*中文总结/g," ").replace(/```[\s\S]*?```/g," ").replace(/`([^`]+)`/g,"$1").replace(/\[([^\]]+)\]\([^)]*\)/g,"$1").replace(/^#{1,6}\s*/gm,"").replace(/^\s*[-*+]\s+/gm,"").replace(/[*_~>#]/g," ").replace(/\s+/g," ").trim()||null),size:e.fileSize,url:e.blobUrl,uploadDate:e.createdAt,processed:e.isProcessed,processedAt:e.processedAt,isPublic:e.isPublic||!1}});C(20===r.length),x(e=>1===k?r:[...e,...r.filter(r=>!e.some(e=>e.id===r.id))])}catch(e){console.error("加载文件失败:",e),S(e instanceof Error?e.message:"加载文件失败")}finally{h(!1)}}},[k,null==d||null==(e=d.user)?void 0:e.id]);(0,t.useEffect)(()=>{var e;(null==d||null==(e=d.user)?void 0:e.id)&&D()},[D,null==d||null==(r=d.user)?void 0:r.id]);let E=p.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())).sort((e,r)=>{let a=0;switch(g){case"name":a=e.name.localeCompare(r.name);break;case"size":a=parseFloat(e.size.replace(" KB",""))-parseFloat(r.size.replace(" KB",""));break;default:a=new Date(e.uploadDate).getTime()-new Date(r.uploadDate).getTime()}return"asc"===N?a:-a});return(0,s.jsxs)("div",{className:"dashboard-shell min-h-screen text-[var(--text-main)] flex flex-col",children:[(0,s.jsx)("header",{className:"sticky top-0 z-20 border-b border-[var(--border-soft)] bg-[var(--header-bg)] backdrop-blur-xl",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-4 flex flex-col gap-3 md:flex-row md:justify-between md:items-center",children:[(0,s.jsxs)("nav",{className:"app-breadcrumb-nav",children:[(0,s.jsxs)(i(),{href:"/",className:"app-breadcrumb-link",children:[(0,s.jsx)(n.default,{src:"/podcast-summarizer-icon.svg",alt:"PodSum logo",width:28,height:28}),(0,s.jsx)("span",{children:"PodSum.cc"})]}),(0,s.jsx)("span",{className:"app-breadcrumb-divider",children:"/"}),(0,s.jsx)("span",{className:"app-breadcrumb-current",children:"My Podcast Summaries"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[(0,s.jsx)(i(),{href:"/upload",className:"bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] text-[var(--btn-primary-text)] text-sm font-medium py-2 px-4 sm:px-6 rounded-lg transition-colors",children:"+ Upload New File"}),(0,s.jsx)("button",{onClick:()=>{(0,l.signOut)({callbackUrl:"/"})},className:"bg-[var(--paper-base)] hover:bg-[var(--paper-muted)] border border-[var(--border-soft)] text-[var(--text-secondary)] text-sm font-medium py-2 px-4 rounded-lg transition-colors",children:"Sign Out"})]})]})}),(0,s.jsx)("main",{className:"container mx-auto w-full max-w-[1400px] p-4 sm:p-6 lg:p-8 flex-grow",children:(0,s.jsxs)("div",{className:"dashboard-panel rounded-2xl p-5 sm:p-6 lg:p-8",children:[(0,s.jsxs)("div",{className:"mb-5 space-y-3",children:[(0,s.jsxs)("div",{className:"text-sm text-[var(--text-secondary)]",children:["Signed in as: ",(0,s.jsx)("span",{className:"font-semibold text-[var(--heading)]",children:null==d||null==(a=d.user)?void 0:a.email})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-0 md:w-[320px]",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search files...",value:v,onChange:e=>f(e.target.value),className:"w-full bg-transparent border-0 border-b border-[var(--border-soft)] px-0 py-2 text-sm text-[var(--text-main)] placeholder:text-[var(--text-muted)] focus:outline-none focus:border-[var(--border-medium)]"}),!b&&(0,s.jsxs)("span",{className:"shrink-0 text-xs text-[var(--text-muted)]",children:[E.length,"/",p.length]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsxs)("select",{value:g,onChange:e=>j(e.target.value),className:"px-3 py-2 rounded-lg border border-[var(--border-soft)] bg-[var(--paper-base)] text-sm text-[var(--text-secondary)] focus:outline-none focus:border-[var(--border-medium)]",children:[(0,s.jsx)("option",{value:"date",children:"Date"}),(0,s.jsx)("option",{value:"name",children:"Name"}),(0,s.jsx)("option",{value:"size",children:"Size"})]}),(0,s.jsx)("button",{onClick:()=>y(e=>"asc"===e?"desc":"asc"),className:"px-3 py-2 rounded-lg border border-[var(--border-soft)] bg-[var(--paper-base)] text-sm text-[var(--text-secondary)] hover:bg-[var(--paper-muted)] transition-colors",children:"asc"===N?"↑":"↓"})]})]})]}),w&&(0,s.jsx)("div",{className:"mb-6 border border-[#d8b7b7] bg-[#fff5f5] text-[var(--danger)] p-4 rounded-xl",children:w}),b&&0===p.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-[var(--border-medium)] border-t-[var(--btn-primary)] mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-[var(--text-muted)]",children:"Loading your files..."})]}):0===E.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-[var(--text-muted)] mb-4",children:v?"No files match your search.":"No files uploaded yet."}),!v&&(0,s.jsx)(i(),{href:"/upload",className:"inline-block bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] text-[var(--btn-primary-text)] font-medium py-2 px-6 rounded-lg transition-colors",children:"Upload Your First File"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[E.map(e=>(0,s.jsx)("div",{className:"bg-[var(--paper-base)] border border-[var(--border-soft)] rounded-xl p-4 hover:bg-[var(--paper-muted)] transition-colors",children:(0,s.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-[var(--heading)] mb-2 whitespace-normal break-words leading-8",children:e.name}),(0,s.jsx)("p",{className:"mb-2.5 text-sm leading-6 text-[var(--text-secondary)] whitespace-pre-wrap break-words",children:e.briefSummary||(e.processed?"暂无摘要。":"摘要生成中...")}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-[var(--text-muted)]",children:[(0,s.jsxs)("span",{children:["Size: ",e.size]}),e.processed&&(0,s.jsx)("span",{className:"text-emerald-600",children:"✓ Processed"}),!e.processed&&(0,s.jsx)("span",{className:"text-amber-600",children:"⟳ Processing"}),(0,s.jsx)("span",{className:e.isPublic?"text-emerald-600":"text-[var(--text-secondary)]",children:e.isPublic?"Public":"Private"})]}),(0,s.jsxs)("div",{className:"text-xs text-[var(--text-muted)] mt-1.5",children:["Uploaded: ",new Date(e.uploadDate).toLocaleString()]})]}),(0,s.jsx)(i(),{href:"/dashboard/".concat(e.id),className:"shrink-0 bg-[var(--paper-subtle)] border border-[var(--border-soft)] text-[var(--text-secondary)] rounded-md px-3 py-1 text-xs hover:bg-[var(--paper-muted)] transition-colors",children:"View"})]})},e.id)),z&&(0,s.jsx)("div",{className:"text-center pt-4",children:(0,s.jsx)("button",{onClick:()=>{P(e=>e+1)},disabled:b,className:"bg-[var(--paper-base)] hover:bg-[var(--paper-muted)] border border-[var(--border-soft)] text-[var(--text-secondary)] px-6 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Loading...":"Load More"})})]})]})})]})}}},e=>{e.O(0,[2619,6489,5239,8441,1255,7358],()=>e(e.s=1969)),_N_E=e.O()}]);