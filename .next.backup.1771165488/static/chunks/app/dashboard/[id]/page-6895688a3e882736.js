(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5029],{4586:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>J});var n=r(5155),a=r(2115),l=r(63),s=r(2619),o=r.n(s),i=r(5239),c=r(7909),d=r(6504),u=r(4514);let m="1.0.1",p="localhost"!==window.location.hostname,x=[];function h(e,t){let r={message:e,details:t,timestamp:new Date().toISOString()};console.log("[DEBUG-CLIENT] ".concat(e),t||""),p&&v("debug",r)}function g(e,t){let r=t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t,n={message:e,error:r,timestamp:new Date().toISOString(),url:window.location.href};x.push(n),console.error("[ERROR-CLIENT] ".concat(e),r||""),p&&v("error",n)}function f(e,t){let r={action:e,details:t,timestamp:new Date().toISOString(),url:window.location.href};console.log("[USER-CLIENT] ".concat(e),t||""),p&&v("user-action",r)}function b(){var e,t,r,n;let a="undefined"!=typeof navigator&&"connection"in navigator&&null!==navigator.connection;return{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenSize:"".concat(window.screen.width,"x").concat(window.screen.height),viewportSize:"".concat(window.innerWidth,"x").concat(window.innerHeight),connection:a?{type:null==(e=navigator.connection)?void 0:e.effectiveType,downlink:null==(t=navigator.connection)?void 0:t.downlink,rtt:null==(r=navigator.connection)?void 0:r.rtt,saveData:null==(n=navigator.connection)?void 0:n.saveData}:void 0,timestamp:new Date().toISOString()}}console.log("[DEBUG-CLIENT] Podcast Summarizer Debug Utils v".concat(m," initializing...")),window.addEventListener("error",e=>{g("Unhandled error",e.error)}),window.addEventListener("unhandledrejection",e=>{g("Unhandled promise rejection",e.reason)});async function v(e,t){try{if("error"!==e&&"user-action"!==e){let e=localStorage.getItem("lastDebugSend"),t=Date.now();if(e&&t-parseInt(e)<5e3)return;localStorage.setItem("lastDebugSend",t.toString())}let r={type:e,data:t,client:b(),version:m};fetch("/api/debug",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}).catch(e=>console.error("Failed to send debug data:",e))}catch(e){console.error("Error sending debug data:",e)}}class y extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("[ERROR-BOUNDARY] Component error caught:",e,t)}render(){if(this.state.hasError){var e;return(0,n.jsxs)("div",{className:"p-4 m-4 bg-red-800/40 border border-red-600 rounded-lg text-white",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-red-300 mb-2",children:"Something went wrong"}),(0,n.jsx)("p",{className:"mb-2",children:"The application encountered an error."}),(0,n.jsxs)("details",{className:"text-sm text-red-200 bg-red-900/50 p-2 rounded",children:[(0,n.jsx)("summary",{className:"cursor-pointer",children:"Error details"}),(0,n.jsx)("p",{className:"mt-2 font-mono whitespace-pre-wrap",children:null==(e=this.state.error)?void 0:e.toString()})]}),(0,n.jsx)("button",{className:"mt-4 px-4 py-2 bg-red-700 hover:bg-red-600 text-white rounded",onClick:()=>window.location.reload(),children:"Reload Page"})]})}return this.props.children}constructor(e){super(e),this.state={hasError:!1}}}function w(e,t){return e instanceof Error&&"AbortError"===e.name?"请求超时（>".concat(Math.round(t/1e3),"s），请重试"):e instanceof Error?e.message:String(e)}async function j(e,t,r){let n=new AbortController,a=setTimeout(()=>n.abort(),r);try{let r=await fetch(e,{...t,signal:n.signal}),a=await r.json();return{response:r,result:a}}finally{clearTimeout(a)}}function N(e){let{podcastId:t,enabled:r,panelHeight:l}=e,[s,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[m,p]=(0,a.useState)(!1),[x,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),b=(0,a.useRef)(null),v=(0,a.useRef)(null),y=(0,a.useCallback)(()=>{let e=b.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},[]);(0,a.useEffect)(()=>{if(!r){o([]),c(""),f(null),v.current=null;return}o([]),c(""),f(null),v.current=null},[t,r]),(0,a.useEffect)(()=>{y()},[s,m,y]);let N=(0,a.useCallback)(async()=>{if(r&&v.current!==t){h(!0),f(null);try{var e;let{response:r,result:n}=await j("/api/qa/".concat(t,"?limit=60"),{method:"GET",headers:{"Content-Type":"application/json"}},15e3);if(!r.ok||!n.success)throw Error(n.error||"Failed to load QA history (".concat(r.status,")"));let a=(Array.isArray(null==(e=n.data)?void 0:e.messages)?n.data.messages:[]).flatMap(e=>[{id:"".concat(e.id,"-q"),role:"user",content:e.question,createdAt:e.createdAt},{id:"".concat(e.id,"-a"),role:"assistant",content:e.answer,createdAt:e.createdAt}]);o(a),v.current=t}catch(e){f(w(e,15e3))}finally{h(!1)}}},[r,t]);(0,a.useEffect)(()=>{N()},[N]);let S=(0,a.useCallback)(async e=>{let n=e.trim();if(!r||!n||m)return;let a=new Date().toISOString(),l="user-".concat(Date.now().toString(36)),s="assistant-pending-".concat(Date.now().toString(36));c(""),f(null),p(!0),o(e=>[...e,{id:l,role:"user",content:n,createdAt:a},{id:s,role:"assistant",content:"思考中...",createdAt:a,pending:!0}]);try{var i,d,u;let{response:e,result:r}=await j("/api/qa/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n,suggested:!1})},7e4);if(!e.ok||!r.success)throw Error(r.error||"Failed to get answer (".concat(e.status,")"));let l="string"==typeof(null==(i=r.data)?void 0:i.answer)?r.data.answer:"未返回回答内容",c="string"==typeof(null==(d=r.data)?void 0:d.id)?"".concat(r.data.id,"-a"):"assistant-".concat(Date.now().toString(36)),m="string"==typeof(null==(u=r.data)?void 0:u.createdAt)?r.data.createdAt:a;o(e=>e.map(e=>e.id===s?{id:c,role:"assistant",content:l,createdAt:m}:e))}catch(t){let e=w(t,7e4);f(e),o(t=>t.map(t=>t.id===s?{...t,content:"请求失败：".concat(e),pending:!1}:t))}finally{p(!1)}},[r,t,m]),E=(0,a.useCallback)(async e=>{e.preventDefault(),await S(i)},[i,S]);if(!r)return null;let k="number"==typeof l&&l>0;return(0,n.jsxs)("aside",{className:"dashboard-panel w-full min-h-[320px] rounded-2xl overflow-hidden flex flex-col",style:k?{height:l}:void 0,children:[(0,n.jsxs)("div",{className:"border-b border-[var(--border-soft)] px-4 py-3",children:[(0,n.jsx)("p",{className:"text-base font-semibold tracking-wide text-[var(--heading)]",children:"Podcast Assistant"}),(0,n.jsx)("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Ask deeper questions from transcript"})]}),(0,n.jsxs)("div",{ref:b,className:"min-h-0 flex-1 overflow-y-auto px-4 py-3 space-y-2.5",children:[x&&(0,n.jsx)("div",{className:"text-xs text-[var(--text-muted)]",children:"Loading history..."}),!x&&0===s.length&&(0,n.jsx)("div",{className:"rounded-xl border border-[var(--border-soft)] bg-[var(--paper-subtle)] px-3 py-2.5 text-xs leading-6 text-[var(--text-secondary)]",children:"你可以在这里追问细节。问答会自动保存到数据库，刷新页面后仍可查看。"}),s.map(e=>(0,n.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,n.jsx)("div",{className:"max-w-[88%] rounded-2xl px-3 py-2 text-sm leading-6 ".concat("user"===e.role?"bg-[var(--btn-primary)] text-[var(--btn-primary-text)] shadow-[0_10px_24px_-18px_rgba(63,122,104,0.85)]":"bg-[var(--paper-base)] border border-[var(--border-soft)] text-[var(--text-main)]"),children:"assistant"===e.role?(0,n.jsx)("div",{className:"qa-markdown",children:(0,n.jsx)(d.oz,{remarkPlugins:[u.A],children:e.content})}):(0,n.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.content})})},e.id))]}),(0,n.jsxs)("form",{onSubmit:E,className:"shrink-0 border-t border-[var(--border-soft)] p-3 bg-[var(--paper-subtle)]",children:[(0,n.jsx)("textarea",{value:i,onChange:e=>c(e.target.value.slice(0,1e3)),placeholder:"输入你的问题，例如：有哪些被忽略但关键的数据？",rows:2,className:"w-full resize-none rounded-xl border border-[var(--border-medium)] bg-[var(--paper-base)] px-3 py-2 text-sm text-[var(--text-main)] placeholder:text-[var(--text-muted)] focus:border-[var(--btn-primary)] focus:outline-none",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S(i))}}),(0,n.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2",children:[(0,n.jsxs)("span",{className:"text-[11px] text-[var(--text-muted)]",children:[i.length,"/",1e3]}),(0,n.jsx)("button",{type:"submit",disabled:m||!i.trim(),className:"rounded-lg bg-[var(--btn-primary)] px-3 py-1.5 text-xs font-semibold text-[var(--btn-primary-text)] hover:bg-[var(--btn-primary-hover)] disabled:cursor-not-allowed disabled:opacity-50",children:m?"回答中...":"Send"})]}),g&&(0,n.jsx)("p",{className:"mt-1.5 text-[11px] text-[var(--danger)]",children:g})]})]})}var S=r(6344);let E="1.0.5";console.log("[DEBUG] Podcast Summarizer v".concat(E," loading..."));let k="podsum-dashboard-content-language",C={summary:"Summary",translation:"Translation",highlights:"Highlights"},D=e=>e.replace(/(\*\*\s*)?(\[[0-9]{2}:[0-9]{2}:[0-9]{1,3}\])(\*\*)?/g,(e,t,r,n)=>"\n".concat(t||"").concat(r).concat(n||"")).replace(/^\n+/,"").trim(),T=e=>e.replace(/\r\n/g,"\n").replace(/^[ \t]*•[ \t]+/gm,"- ").replace(/\u00A0/g," ").trim(),R=e=>e.replace(/\r\n/g,"\n").replace(/\u00A0/g," "),A=e=>{let t=String(e||"").replace(/\r\n/g,"\n").trim();if(!t)return{zh:"",en:""};let r="<<<SUMMARY_EN>>>",n="<<<SUMMARY_ZH>>>",a=t.indexOf(r),l=t.indexOf(n);if(a>=0&&l>a)return{en:T(t.slice(a+r.length,l)),zh:T(t.slice(l+n.length))};let s=t.search(/#\s*English Summary/i),o=t.search(/#\s*中文总结/i);return s>=0&&o>s?{en:T(t.slice(s,o)),zh:T(t.slice(o))}:o>=0?{en:T(t.slice(0,o)),zh:T(t.slice(o))}:{en:"",zh:T(t)}},U=new Set(["youtube","transcript","summary","podsum","full","text","translated","analysis"]),_=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),M=e=>{let t=e.trim().match(/^(\d{2}):(\d{2}):(\d{2})(?:[.,]\d{1,3})?$/);return t?"".concat(t[1],":").concat(t[2],":").concat(t[3]):null},I=(0,c.default)(()=>Promise.all([r.e(6714),r.e(3862),r.e(7697),r.e(4890)]).then(r.bind(r,4890)),{loadableGenerated:{webpack:()=>[4890]},ssr:!1,loading:()=>(0,n.jsx)("div",{className:"h-full w-full flex items-center justify-center text-sm text-[var(--text-muted)]",children:"Loading mind map..."})}),z=(e,t)=>{if(!e||"object"!=typeof e)return null;let r="string"==typeof e.label?e.label.trim():"";if(!r)return null;let n={label:r.slice(0,280)};if(t>=5)return n;let a=(Array.isArray(e.children)?e.children:[]).map(e=>z(e,t+1)).filter(e=>!!e).slice(0,14);return a.length>0&&(n.children=a),n},O=e=>{var t;if(!e)return null;let r=e;if("string"==typeof r)try{r=JSON.parse(r)}catch(e){return null}if(!r||"object"!=typeof r)return null;let n=z(null!=(t=r.root)?t:r,0);return n&&n.children&&0!==n.children.length?{root:n}:null},F=/^\[[0-9]{2}:[0-9]{2}:[0-9]{1,3}(?:\s*-->\s*[0-9]{2}:[0-9]{2}:[0-9]{1,3})?\]$/,B=e=>{if("string"==typeof e||"number"==typeof e)return String(e);if(Array.isArray(e))return e.map(B).join("");if(e&&"object"==typeof e&&"props"in e){var t,r;return B(null!=(r=null==(t=e.props)?void 0:t.children)?r:"")}return""},G={strong(e){let{children:t}=e,r=B(t).replace(/\s+/g," ").trim(),a=F.test(r);return(0,n.jsx)("strong",{className:a?"markdown-timestamp-strong":void 0,children:t})}},L=e=>"number"!=typeof e||Number.isNaN(e)?"-":e.toLocaleString(),P=e=>{let t="string"==typeof e.title?e.title.trim():"";return t||String(e.originalFileName||"").replace(/\.[^.]+$/g,"").trim()||"Transcript"};function J(){let e=(0,l.useParams)(),t=null==e?void 0:e.id,[r,s]=(0,a.useState)("summary"),[c,m]=(0,a.useState)(null),[w,j]=(0,a.useState)(!0),[z,B]=(0,a.useState)(null),[J,Z]=(0,a.useState)(!1),[q,H]=(0,a.useState)(!1),[$,Y]=(0,a.useState)(!0),[K,V]=(0,a.useState)(!0),[W,Q]=(0,a.useState)(null),[X,ee]=(0,a.useState)("idle"),[et,er]=(0,a.useState)(0),[en,ea]=(0,a.useState)(void 0),[el,es]=(0,a.useState)("light"),[eo,ei]=(0,a.useState)("zh"),[ec,ed]=(0,a.useState)({task:null,completed:0,total:0}),[eu,em]=(0,a.useState)(""),[ep,ex]=(0,a.useState)(!1),[eh,eg]=(0,a.useState)("idle"),[ef,eb]=(0,a.useState)(null),ev=(0,a.useRef)(null),ey=(0,a.useRef)(null),ew=(0,a.useRef)(!1),ej=(0,a.useRef)(!0),eN=(0,a.useRef)({summary:0,fullText:0,mindMap:0}),eS=(0,a.useRef)(0),eE=(0,a.useRef)(!1),ek=(0,a.useRef)(null),eC=(0,a.useRef)(!1),eD=(0,a.useRef)(null),eT=(0,a.useRef)(new Map),[eR,eA]=(0,a.useState)(!1),[eU,e_]=(0,a.useState)({appVersion:E,initialized:!1,lastAction:"init",processingState:"idle",errors:[],networkRequests:[],sessionInfo:{id:t||"",isProcessing:!1,requestSent:!1,lastHeightRef:0}}),eM=(0,a.useRef)([]);console.log("[DEBUG] Dashboard initializing for ID: ".concat(t)),h("Dashboard initializing for ID: ".concat(t));let eI=(0,a.useCallback)(e=>{ev.current=e,e&&(e.scrollTop=eN.current[r]||0,ej.current=e.scrollHeight-e.scrollTop-e.clientHeight<=64)},[r]),ez=(0,a.useCallback)(()=>{let e=ey.current;if(!e)return void ea(void 0);let t=Math.round(e.getBoundingClientRect().height);Number.isFinite(t)&&t>0&&ea(t)},[]),eO=(0,a.useCallback)(()=>{let e=ev.current;e&&(eN.current[r]=e.scrollTop,ej.current=e.scrollHeight-e.scrollTop-e.clientHeight<=64)},[r]),eF=e=>{e!==r&&(ev.current&&(eN.current[r]=ev.current.scrollTop),null!==ek.current&&(clearTimeout(ek.current),ek.current=null),ee("idle"),s(e))},eB=(0,a.useCallback)(()=>{ed({task:null,completed:0,total:0})},[]);(0,a.useCallback)((e,t,r)=>{if("number"==typeof t&&"number"==typeof r&&r>0)return void ed({task:e,completed:Math.min(Math.max(t+1,0),r),total:r});ed(t=>({...t,task:e}))},[]);let eG=(0,a.useCallback)(e=>{ee(e),null!==ek.current&&(clearTimeout(ek.current),ek.current=null),"idle"!==e&&(ek.current=setTimeout(()=>{ee("idle")},1500))},[]),eL=(0,a.useCallback)(e=>{if(!e){Z(!1),ew.current=!1,Q(null),eE.current=!1,eB();return}if("queued"===e.status||"processing"===e.status){B(null),Z(!0),ew.current=!0,eE.current=!0,Y(!1),V(!1),Q(e.statusMessage||("queued"===e.status?"已进入后台队列":"后台处理中..."));let t="summary"===e.currentTask||"translation"===e.currentTask||"highlights"===e.currentTask?e.currentTask:"summary";ed({task:t,completed:"number"==typeof e.progressCurrent?e.progressCurrent:0,total:"number"==typeof e.progressTotal?e.progressTotal:0});return}if("failed"===e.status){Z(!1),ew.current=!1,eE.current=!1,Q(e.statusMessage||null),e.lastError&&B("后台处理失败: ".concat(e.lastError)),eB();return}Z(!1),ew.current=!1,eE.current=!1,B(null),Q(null),Y(!0),V(!0),eB()},[eB]),eP=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t&&(e||!eE.current)){eE.current=!0,B(null),Z(!0),ew.current=!0,Y(!1),V(!1),Q(e?"已提交重新处理任务...":"已提交后台处理任务..."),ed({task:"summary",completed:0,total:0});try{var r;let n=await fetch("/api/process/enqueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,force:e})}),a=await n.json();if(!n.ok||!a.success)throw Error(a.error||"Failed to enqueue job (".concat(n.status,")"));(null==(r=a.data)?void 0:r.job)&&eL(a.data.job)}catch(t){let e=t instanceof Error?t.message:String(t);B("提交后台任务失败: ".concat(e)),Z(!1),ew.current=!1,eE.current=!1,Q(null),eB()}}},[eL,t,eB]);if((0,a.useEffect)(()=>()=>{null!==ek.current&&clearTimeout(ek.current)},[]),(0,a.useEffect)(()=>{t&&eD.current!==t&&(eD.current=t,eC.current=!1,j(!0))},[t]),(0,a.useEffect)(()=>{let e=ey.current;if(!e||(ez(),"undefined"==typeof ResizeObserver))return;let t=new ResizeObserver(()=>{ez()});return t.observe(e),()=>t.disconnect()},[ez,r,c,J,ec.completed,ec.total]),(0,a.useEffect)(()=>{let e=window.localStorage.getItem("podsum-dashboard-theme");if("light"===e||"dark"===e)return void es(e);es(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},[]),(0,a.useEffect)(()=>{window.localStorage.setItem("podsum-dashboard-theme",el)},[el]),(0,a.useEffect)(()=>{let e=window.localStorage.getItem(k);("zh"===e||"en"===e)&&ei(e)},[]),(0,a.useEffect)(()=>{window.localStorage.setItem(k,eo)},[eo]),(0,a.useEffect)(()=>{if(!c){em(""),eg("idle"),eb(null);return}em(c.sourceReference||""),eg("idle"),eb(null)},[null==c?void 0:c.sourceReference,t]),!t||"undefined"===t||"null"===t)return(0,n.jsx)("div",{className:"min-h-screen bg-[#f3eee3] text-[var(--text-main)] flex items-center justify-center px-4",children:(0,n.jsxs)("div",{className:"text-center max-w-md p-8 bg-[var(--paper-base)] border border-[var(--border-soft)] rounded-2xl shadow-[0_18px_42px_-30px_rgba(80,67,44,0.55)]",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-[var(--danger)] mb-4",children:"Invalid File ID"}),(0,n.jsx)("p",{className:"text-[var(--text-secondary)] mb-6",children:"The file ID in the URL is invalid or missing. This usually happens when:"}),(0,n.jsxs)("ul",{className:"text-left text-sm text-[var(--text-muted)] mb-6 space-y-2",children:[(0,n.jsx)("li",{children:"• You navigated to an incomplete URL"}),(0,n.jsx)("li",{children:"• The file upload process was interrupted"}),(0,n.jsx)("li",{children:"• You’re using an old or broken bookmark"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(o(),{href:"/upload",className:"block w-full bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] text-[var(--btn-primary-text)] font-semibold py-3 px-4 rounded-lg transition-colors",children:"Upload New File"}),(0,n.jsx)(o(),{href:"/my",className:"block w-full bg-[var(--paper-subtle)] hover:bg-[var(--paper-muted)] border border-[var(--border-soft)] text-[var(--text-secondary)] font-semibold py-3 px-4 rounded-lg transition-colors",children:"View File History"})]})]})});let eJ=(0,a.useCallback)(e=>{try{e_({appVersion:E,initialized:!0,lastAction:e,processingState:J?"processing":(null==c?void 0:c.summaryZh)?"complete":"idle",errors:[...x],networkRequests:eM.current,sessionInfo:{id:t,isProcessing:J,requestSent:eE.current,lastHeightRef:eS.current}})}catch(e){console.error("[DEBUG] Error capturing debug state:",e)}},[t]);(0,a.useEffect)(()=>{if(!eR)return;eJ("init");let e=setInterval(()=>{eR&&eJ("interval")},3e3);return()=>clearInterval(e)},[eR,J,eJ]);let eZ=(0,a.useCallback)(async(e,t)=>{let r=performance.now(),n=Date.now().toString(36);try{console.log("[DEBUG-NET-".concat(n,"] Starting request to ").concat(e)),h("Network request started",{url:e,options:{method:t.method,headers:t.headers}});let a=await fetch(e,t),l=performance.now()-r;return console.log("[DEBUG-NET-".concat(n,"] Response received: ").concat(a.status," in ").concat(l.toFixed(0),"ms")),eM.current=[...eM.current.slice(-9),{url:e,status:a.status,timestamp:new Date().toISOString(),duration:Number(l.toFixed(0))}],a}catch(a){let t=performance.now()-r;throw console.error("[DEBUG-NET-".concat(n,"] Request failed after ").concat(t.toFixed(0),"ms:"),a),g("Network request failed",{url:e,error:a,duration:t}),a}},[]),eq=()=>{try{var e;let r={timestamp:new Date().toISOString(),app:{version:E,url:window.location.href,id:t},state:{isLoading:w,isProcessing:J,requestSent:eE.current,hasError:!!z,errorMessage:z,dataSummaryLength:null==c||null==(e=c.summaryZh)?void 0:e.length},debug:eU,browser:b(),errors:[...x]},n=JSON.stringify(r,null,2);navigator.clipboard.writeText(n),alert("Debug info copied to clipboard!"),f("copy-debug-info")}catch(e){console.error("[DEBUG] Failed to copy debug info:",e),alert("Failed to copy debug info: "+(e instanceof Error?e.message:String(e)))}},eH=(0,a.useCallback)(()=>{console.log("[DEBUG] Attempting to scroll to bottom, isProcessing: ".concat(ew.current,", autoScroll: ").concat(ej.current)),ej.current&&ev.current&&(ev.current.scrollTo({top:ev.current.scrollHeight,behavior:"smooth"}),eS.current=ev.current.scrollHeight,console.log("[DEBUG] Updated lastHeightRef to ".concat(eS.current)))},[]);(0,a.useEffect)(()=>{var e;console.log("[DEBUG] Content change detected, summary length: ".concat(null==c||null==(e=c.summaryZh)?void 0:e.length,", isProcessing: ").concat(ew.current)),"summary"===r&&(null==c?void 0:c.summaryZh)&&ew.current&&requestAnimationFrame(()=>{eH()})},[r,null==c?void 0:c.summaryZh,eH]),(0,a.useEffect)(()=>{if(t){console.log("[DEBUG] useEffect triggered for ID: ".concat(t,", isProcessing: ").concat(J,", requestSent: ").concat(eE.current)),h("Dashboard useEffect triggered",{id:t,isProcessing:J,requestSent:eE.current});let e=performance.now(),r=!eC.current,n=()=>{eC.current=!0,j(!1)};r&&j(!0),B(null),console.log("[DEBUG] 从数据库获取分析结果..."),eZ("/api/analysis/".concat(t),{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(a=>{var l,s,o,i,c,d,u,x,h,g,f,b,y,w;if(console.log("[DEBUG] 数据库API响应:",a),window.__PODSUM_DEBUG__=a,console.log("[DEBUG] 完整API响应:",JSON.stringify(a,null,2)),console.log("[DEBUG] canEdit值:",null==(l=a.data)?void 0:l.canEdit),console.log("[DEBUG] 用户会话:",null==(s=a.data)?void 0:s.session),console.log("[DEBUG] podcast.userId:",null==(i=a.data)||null==(o=i.podcast)?void 0:o.userId),a.success&&a.data){let{podcast:l,analysis:s,isProcessed:o,canEdit:i,processingJob:j}=a.data;if(o&&s){console.log("[DEBUG] 从数据库加载完整分析结果");let r=A(s.summary||"");m({title:P(l),originalFileName:l.originalFileName,originalFileSize:l.fileSize,blobUrl:null!=(h=l.blobUrl)?h:null,summaryZh:T(s.summaryZh||r.zh||s.summary||"Summary not available."),summaryEn:T(s.summaryEn||r.en||"English summary not available."),translation:R(s.translation||"Translation not available."),fullTextHighlights:T(D(s.highlights||"Highlights not available.")),fullTextOriginal:"",mindMapJsonZh:O(null!=(g=s.mindMapJsonZh)?g:s.mindMapJson),mindMapJsonEn:O(s.mindMapJsonEn),processedAt:s.processedAt,tokenCount:null!=(f=s.tokenCount)?f:null,wordCount:null!=(b=s.wordCount)?b:null,characterCount:null!=(y=s.characterCount)?y:null,sourceReference:null!=(w=l.sourceReference)?w:null}),Y(!0),V(!0),Q(null),eG("idle"),eB(),Z(!1),ew.current=!1,eE.current=!1,n(),H(i),function(e,t,r){let n={operation:e,durationMs:t,metadata:r,timestamp:new Date().toISOString()};console.log("[PERF-CLIENT] ".concat(e,": ").concat(t,"ms"),r||""),p&&v("performance",n)}("dashboard-load-database-data",performance.now()-e,{id:t,dataSize:{summaryZh:(null==(c=s.summaryZh||s.summary)?void 0:c.length)||0,summaryEn:(null==(d=s.summaryEn)?void 0:d.length)||0,translation:(null==(u=s.translation)?void 0:u.length)||0,highlights:(null==(x=s.highlights)?void 0:x.length)||0}})}else l?(console.log("[DEBUG] 数据库中有播客信息但无分析结果，开始处理"),m(e=>{var t,r,n,a,o,i,c,d,u,m,p,x,h,g,f,b,v;let y=A((null==s?void 0:s.summary)||"");return{title:P(l),originalFileName:l.originalFileName,originalFileSize:l.fileSize,blobUrl:null!=(r=null!=(t=l.blobUrl)?t:null==e?void 0:e.blobUrl)?r:null,summaryZh:(null==s?void 0:s.summaryZh)||(null==s?void 0:s.summary)?T((null==s?void 0:s.summaryZh)||y.zh||(null==s?void 0:s.summary)||""):(null==e?void 0:e.summaryZh)||"",summaryEn:(null==s?void 0:s.summaryEn)||(null==s?void 0:s.summary)?T((null==s?void 0:s.summaryEn)||y.en||""):(null==e?void 0:e.summaryEn)||"",translation:(null==s?void 0:s.translation)?R(s.translation):(null==e?void 0:e.translation)||"",fullTextHighlights:(null==s?void 0:s.highlights)?T(D(s.highlights)):(null==e?void 0:e.fullTextHighlights)||"",fullTextOriginal:(null!=(n=l.blobUrl)?n:null)===(null!=(a=null==e?void 0:e.blobUrl)?a:null)&&(null==e?void 0:e.fullTextOriginal)||"",mindMapJsonZh:null!=(c=null!=(i=O(null!=(o=null==s?void 0:s.mindMapJsonZh)?o:null==s?void 0:s.mindMapJson))?i:null==e?void 0:e.mindMapJsonZh)?c:null,mindMapJsonEn:null!=(u=null!=(d=O(null==s?void 0:s.mindMapJsonEn))?d:null==e?void 0:e.mindMapJsonEn)?u:null,processedAt:(null==s?void 0:s.processedAt)||(null==e?void 0:e.processedAt)||void 0,tokenCount:null!=(p=null!=(m=null==s?void 0:s.tokenCount)?m:null==e?void 0:e.tokenCount)?p:null,wordCount:null!=(h=null!=(x=null==s?void 0:s.wordCount)?x:null==e?void 0:e.wordCount)?h:null,characterCount:null!=(f=null!=(g=null==s?void 0:s.characterCount)?g:null==e?void 0:e.characterCount)?f:null,sourceReference:null!=(v=null!=(b=l.sourceReference)?b:null==e?void 0:e.sourceReference)?v:null}}),Y(!1),V(!1),Q("等待后台处理..."),r&&(eG("idle"),eB()),n(),H(i),j?eL(j):i?eP(!1):(Z(!1),ew.current=!1,eE.current=!1)):(console.log("[DEBUG] 数据库中没有找到该ID的信息"),B("File not found in database. The file may have been deleted or never uploaded."),n())}else console.log("[DEBUG] 数据库API调用失败"),B(a.error||"Failed to load file information from database."),n()}).catch(e=>{console.error("[DEBUG] 数据库API调用出错:",e),B("Failed to connect to database: "+e.message),n()})}},[t,et]),(0,a.useEffect)(()=>{if(!t||!J)return;let e=setInterval(()=>{er(e=>e+1)},5e3);return()=>clearInterval(e)},[t,J]);let e$=()=>{if(console.log("[DEBUG] Retry button clicked"),f("retry-processing",{id:t}),eJ("retry-clicked"),J)return void console.log("[DEBUG] Already processing ID: ".concat(t,", avoiding duplicate retry request"));console.log("[DEBUG] Starting retry process"),B(null),eE.current=!1,eP(!0)},eY=async()=>{if(!t||!q||ep)return;let e=eu.trim();ex(!0),eb(null),eg("idle");try{let r=await fetch("/api/podcasts/".concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceReference:e||null})}),n=await r.json();if(!r.ok||!n.success)throw Error(n.error||"Save failed (".concat(r.status,")"));m(t=>t?{...t,sourceReference:e||null}:t),eg("saved")}catch(e){eg("failed"),eb(e instanceof Error?e.message:String(e))}finally{ex(!1)}},eK=((null==c?void 0:c.sourceReference)||"").trim(),eV=!!eK&&(e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}})(eK);(0,a.useEffect)(()=>{let e=null==c?void 0:c.blobUrl;if(!e)return;let t=!1,r=r=>{var n;let a=(e=>{let t=(e=>{let t=e.replace(/\r\n/g,"\n").replace(/^\uFEFF/,"").trim();if(!t)return[];let r=t.split(/\n\s*\n+/g),n=[];for(let e of r){let t=e.split("\n").map(e=>e.trim()).filter(Boolean);if(0===t.length)continue;let r=0;/^\d+$/.test(t[0])&&(r=1);let a=t[r];if(!a||!a.includes("--\x3e"))continue;let[l]=a.split("--\x3e").map(e=>e.trim()),s=M(l);if(!s)continue;let o=t.slice(r+1).join(" ").replace(/\s+/g," ").trim();o&&n.push({timestamp:s,text:o})}return n})(e.srtContent);if(0===t.length)return T(e.srtContent);let r=(e=>{var t;let r=[...(e=>{let t=Array.from(e.matchAll(/\*\*([^*]+)\*\*/g)).map(e=>{var t;return(null==(t=e[1])?void 0:t.trim())||""}).filter(Boolean),r=[],n=new Set;for(let e of t){let t=e.replace(/\s+/g," ").trim();if(!t||t.length<2||t.length>32||F.test(t))continue;let a=t.toLowerCase();if(!(n.has(a)||U.has(a))&&(n.add(a),r.push(t),r.length>=16))break}return r})(e.translatedHighlights),...(0,S.z)({title:e.title,sourceReference:null!=(t=e.sourceReference)?t:null,summary:e.srtContent})],n=[],a=new Set;for(let e of r){let t=e.replace(/^#+/,"").replace(/\s+/g," ").trim();if(!t||t.length<2||t.length>32||/^\d+$/.test(t)||/^[^A-Za-z0-9\u4E00-\u9FFF]+$/.test(t))continue;let r=t.toLowerCase();if(!(a.has(r)||U.has(r))&&(a.add(r),n.push(t),n.length>=16))break}return n})(e);return t.map(e=>{let{timestamp:t,text:n}=e,a=((e,t)=>{if(!e.trim())return e;let r=e,n=0;for(let e of t){if(n>=2)break;if(!e||r.includes("**".concat(e,"**")))continue;if(/[A-Za-z]/.test(e)){let t=RegExp("\\b(".concat(_(e),")\\b"),"i");t.test(r)&&(r=r.replace(t,"**$1**"),n+=1);continue}let t=r.indexOf(e);t>=0&&(r="".concat(r.slice(0,t),"**").concat(e,"**").concat(r.slice(t+e.length)),n+=1)}return r})(n,r);return"**[".concat(t,"]** ").concat(a)}).join("\n\n")})({title:(null==c?void 0:c.title)||"",sourceReference:null!=(n=null==c?void 0:c.sourceReference)?n:null,srtContent:r,translatedHighlights:(null==c?void 0:c.fullTextHighlights)||""});t||m(t=>t&&t.blobUrl===e&&t.fullTextOriginal!==a?{...t,fullTextOriginal:a}:t)},n=eT.current.get(e);return"string"==typeof n?(r(n),()=>{t=!0}):((async()=>{try{let t=await fetch(e);if(!t.ok)throw Error("Failed to fetch transcript (".concat(t.status,")"));let n=(await t.text()).replace(/^\uFEFF/,"");eT.current.set(e,n),r(n)}catch(e){console.error("[DEBUG] Failed to prepare original full text:",e)}})(),()=>{t=!0})},[null==c?void 0:c.blobUrl,null==c?void 0:c.title,null==c?void 0:c.sourceReference,null==c?void 0:c.fullTextHighlights]),(0,a.useCallback)(()=>{if(!c)return"";if("summary"===r)return"zh"===eo?c.summaryZh:c.summaryEn;if("mindMap"===r){var e,t,n,a;let r="zh"===eo?null!=(t=null!=(e=c.mindMapJsonZh)?e:c.mindMapJsonEn)?t:null:null!=(a=null!=(n=c.mindMapJsonEn)?n:c.mindMapJsonZh)?a:null;return r?JSON.stringify(r,null,2):""}return"zh"===eo?c.fullTextHighlights:c.fullTextOriginal||c.translation},[r,eo,c]);let eW=e=>"shrink-0 px-3 sm:px-4 py-2 text-sm font-semibold border-b-2 transition-colors whitespace-nowrap\n     ".concat(r===e?"text-[var(--heading)] border-[var(--btn-primary)]":"text-[var(--text-muted)] border-transparent hover:text-[var(--text-main)] hover:border-[var(--border-medium)]"),eQ=!!(c&&!J&&$&&K);return(0,n.jsx)(y,{children:(0,n.jsxs)("div",{className:"dashboard-shell min-h-screen text-[var(--text-main)] flex flex-col","data-theme":el,children:[(0,n.jsx)("header",{className:"sticky top-0 z-20 border-b border-[var(--border-soft)] bg-[var(--header-bg)] backdrop-blur-xl",children:(0,n.jsxs)("div",{className:"mx-auto w-full max-w-[1400px] px-4 sm:px-6 lg:px-8 py-4 flex flex-col gap-3 md:flex-row md:justify-between md:items-center",children:[(0,n.jsxs)("nav",{className:"app-breadcrumb-nav w-full md:w-auto",children:[(0,n.jsxs)(o(),{href:"/",className:"app-breadcrumb-link tracking-wide",children:[(0,n.jsx)(i.default,{src:"/podcast-summarizer-icon.svg",alt:"PodSum logo",width:28,height:28}),(0,n.jsx)("span",{children:"PodSum.cc"})]}),(0,n.jsx)("span",{className:"app-breadcrumb-divider",children:"/"}),(0,n.jsx)("span",{className:"app-breadcrumb-current max-w-[60vw] sm:max-w-[68vw] md:max-w-xl lg:max-w-2xl",title:(null==c?void 0:c.title)||"",children:(null==c?void 0:c.title)||""})]}),(0,n.jsx)("div",{className:"flex items-center gap-2 flex-wrap justify-end w-full md:w-auto",children:(0,n.jsxs)("div",{className:"inline-flex items-center rounded-lg border border-[var(--border-soft)] bg-[var(--paper-base)] p-0.5",children:[(0,n.jsx)("button",{onClick:()=>es("light"),className:"px-2.5 py-1.5 text-xs rounded-md transition-colors ".concat("light"===el?"bg-[var(--btn-primary)] text-[var(--btn-primary-text)]":"text-[var(--text-secondary)] hover:bg-[var(--paper-muted)]"),children:"Light Mode"}),(0,n.jsx)("button",{onClick:()=>es("dark"),className:"px-2.5 py-1.5 text-xs rounded-md transition-colors ".concat("dark"===el?"bg-[var(--btn-primary)] text-[var(--btn-primary-text)]":"text-[var(--text-secondary)] hover:bg-[var(--paper-muted)]"),children:"Dark Mode"})]})})]})}),!c&&!z&&w&&(0,n.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center rounded-2xl border border-[var(--border-soft)] bg-[var(--paper-base)] px-8 py-8 shadow-[0_18px_40px_-28px_rgba(80,67,44,0.45)]",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-[var(--border-medium)] border-t-[var(--btn-primary)] mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-[var(--text-secondary)] text-sm sm:text-base tracking-wide",children:"Loading transcript data..."})]})}),z&&(0,n.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-[var(--danger)] border border-[#d8b7b7] bg-[#fff5f5] p-6 sm:p-7 rounded-2xl flex flex-col items-center max-w-md shadow-[0_18px_42px_-30px_rgba(125,73,73,0.52)]",children:[(0,n.jsx)("p",{className:"mb-4 text-center leading-7",children:z}),(0,n.jsx)("button",{onClick:e$,className:"px-6 py-2.5 bg-[var(--danger)] hover:bg-[#8f4343] rounded-xl text-white text-sm font-semibold transition-colors",disabled:J,children:J?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"inline-block animate-spin mr-2",children:"↻"}),"处理中..."]}):"重新处理文件"})]})}),c&&(0,n.jsxs)("main",{className:"container mx-auto w-full max-w-[1400px] p-4 sm:p-6 lg:p-8 flex-grow flex flex-col gap-4 md:gap-6",children:[(0,n.jsxs)("section",{className:"dashboard-panel rounded-2xl p-3 sm:p-4",children:[(0,n.jsxs)("div",{className:"grid gap-3 lg:grid-cols-[minmax(0,1fr)_auto] lg:items-start",children:[(0,n.jsxs)("div",{className:"min-w-0 space-y-2",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 text-[11px] sm:text-xs",children:[(0,n.jsxs)("span",{className:"inline-flex max-w-full items-center gap-1 rounded-md border border-[var(--border-soft)] bg-[var(--paper-base)] px-2 py-0.5 text-[var(--text-secondary)]",children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"Original"}),(0,n.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-[300px]",title:c.originalFileName,children:c.originalFileName})]}),c.processedAt&&(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-md border border-[var(--border-soft)] bg-[var(--paper-base)] px-2 py-0.5 text-[var(--text-secondary)]",children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"Time"}),(0,n.jsx)("span",{children:new Date(c.processedAt).toLocaleString()})]}),(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-md border border-[var(--border-soft)] bg-[var(--paper-base)] px-2 py-0.5 text-[var(--text-secondary)]",children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"Tokens"}),(0,n.jsx)("span",{children:L(c.tokenCount)})]}),(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-md border border-[var(--border-soft)] bg-[var(--paper-base)] px-2 py-0.5 text-[var(--text-secondary)]",children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"Words"}),(0,n.jsx)("span",{children:L(c.wordCount)})]})]}),(0,n.jsx)("div",{children:q?(0,n.jsxs)("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center",children:[(0,n.jsx)("input",{type:"text",value:eu,onChange:e=>{em(e.target.value),eg("idle"),eb(null)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),eY())},placeholder:"Source URL 或备注",className:"w-full rounded-lg border border-[var(--border-soft)] bg-[var(--paper-base)] px-3 py-2 text-[var(--text-main)] text-sm focus:outline-none focus:border-[var(--border-medium)]"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap shrink-0",children:[(0,n.jsx)("button",{onClick:eY,disabled:ep,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-[var(--paper-subtle)] hover:bg-[var(--paper-muted)] border border-[var(--border-soft)] text-[var(--text-secondary)] disabled:opacity-60 disabled:cursor-not-allowed",children:ep?"Saving...":"Save Source"}),"saved"===eh&&(0,n.jsx)("span",{className:"text-xs text-emerald-700",children:"Saved"}),"failed"===eh&&(0,n.jsx)("span",{className:"text-xs text-[var(--danger)]",children:ef||"Save failed"}),eK&&eV&&(0,n.jsx)("a",{href:eK,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-[var(--btn-primary)] underline",children:"打开来源链接"})]})]}):(0,n.jsx)("div",{className:"text-sm",children:eK?eV?(0,n.jsx)("a",{href:eK,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--btn-primary)] underline break-all",children:eK}):(0,n.jsx)("p",{className:"text-[var(--text-main)] break-words leading-6",children:eK}):(0,n.jsx)("p",{className:"text-[var(--text-muted)]",children:"-"})})})]}),q&&(0,n.jsx)("button",{onClick:e$,className:"w-full lg:w-auto lg:min-w-[140px] py-2 px-4 bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] rounded-xl text-[var(--btn-primary-text)] text-sm font-semibold transition-colors flex items-center justify-center shadow-[0_16px_36px_-20px_rgba(63,122,104,0.8)]",disabled:J,children:J?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"处理中..."]}):"重新处理文件"})]}),eR&&(0,n.jsxs)("div",{className:"mt-4 p-3 bg-[var(--paper-subtle)] border border-[var(--border-soft)] rounded-xl text-xs text-[var(--text-secondary)]",children:[(0,n.jsx)("h3",{className:"font-bold mb-2 tracking-wide",children:"Debug Info"}),(0,n.jsxs)("div",{children:["canEdit: ",q.toString()]}),(0,n.jsxs)("div",{children:["isLoading: ",w.toString()]}),(0,n.jsxs)("div",{children:["isProcessing: ",J.toString()]}),(0,n.jsxs)("div",{children:["hasError: ",!!z]}),(0,n.jsx)("button",{onClick:()=>console.log("window.__PODSUM_DEBUG__:",window.__PODSUM_DEBUG__),className:"mt-2 px-2.5 py-1 bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] text-[var(--btn-primary-text)] rounded-lg text-xs transition-colors",children:"Log Debug to Console"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_380px] 2xl:grid-cols-[minmax(0,1fr)_420px] gap-4 md:gap-6 xl:items-start",children:[(0,n.jsxs)("section",{className:"w-full min-w-0",children:[(0,n.jsx)("div",{className:"mb-4 sm:mb-6",children:(0,n.jsxs)("div",{className:"flex items-center gap-1.5 overflow-x-auto border-b border-[var(--border-soft)] pb-0.5 [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[(0,n.jsx)("button",{onClick:()=>eF("summary"),className:"".concat(eW("summary")," shrink-0"),children:"Summary"}),(0,n.jsx)("button",{onClick:()=>eF("fullText"),className:"".concat(eW("fullText")," shrink-0"),children:"Full Text Translated"}),(0,n.jsx)("button",{onClick:()=>eF("translate"),className:"".concat(eW("translate")," shrink-0"),children:"Full Text"}),(0,n.jsx)("button",{onClick:()=>eF("mindMap"),className:"".concat(eW("mindMap")," shrink-0"),children:"Mind Map"})]})}),J&&(0,n.jsxs)("div",{className:"mb-4 rounded-2xl border border-[#bed3c9] bg-[var(--paper-base)] p-3.5 sm:p-4 shadow-[0_12px_28px_-24px_rgba(73,93,83,0.5)]",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs flex-wrap",children:[(0,n.jsxs)("div",{className:"text-[var(--text-secondary)] flex items-center gap-2",children:[(0,n.jsx)("span",{className:"inline-block h-2 w-2 rounded-full bg-[var(--accent)] animate-pulse"}),(0,n.jsx)("span",{children:W||"处理中..."})]}),(0,n.jsxs)("span",{className:"text-[var(--text-muted)] tracking-wide",children:[ec.task?C[ec.task]:"Preparing",ec.total>0?" \xb7 ".concat(ec.completed,"/").concat(ec.total):""]})]}),ec.total>0&&(0,n.jsx)("div",{className:"mt-2.5 h-2 w-full rounded-full bg-[#d9d3c7] overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-[#7ea08f] to-[#3f7a68] transition-all duration-300 ease-out",style:{width:"".concat(Math.min(100,Math.round(ec.completed/ec.total*100)),"%")}})})]}),(0,n.jsx)("div",{ref:ey,className:"dashboard-panel min-h-[240px] sm:min-h-[320px] rounded-2xl overflow-hidden",children:(()=>{if(w&&!c)return(0,n.jsx)("div",{className:"text-center p-10 text-[var(--text-muted)]",children:"Loading content..."});if(z)return(0,n.jsxs)("div",{className:"text-center p-10 text-[var(--danger)]",children:["Error: ",z]});if(!c)return(0,n.jsx)("div",{className:"text-center p-10 text-[var(--text-muted)]",children:"No data available."});switch(r){case"summary":return(0,n.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:(0,n.jsx)("div",{className:"streaming-content dashboard-reading",ref:eI,onScroll:eO,children:(0,n.jsx)("div",{className:"markdown-body",children:(0,n.jsx)(d.oz,{remarkPlugins:[u.A],components:G,children:("zh"===eo?c.summaryZh:c.summaryEn)||"正在生成摘要..."})})})});case"fullText":return(0,n.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:(0,n.jsx)("div",{className:"streaming-content dashboard-reading",ref:eI,onScroll:eO,children:(0,n.jsx)("div",{className:"markdown-body",children:(0,n.jsx)(d.oz,{remarkPlugins:[u.A],components:G,children:("zh"===eo?c.fullTextHighlights:c.fullTextOriginal||c.translation)||"正在生成重点内容..."})})})});case"mindMap":var e,t,a,l;let s="zh"===eo?null!=(t=null!=(e=c.mindMapJsonZh)?e:c.mindMapJsonEn)?t:null:null!=(l=null!=(a=c.mindMapJsonEn)?a:c.mindMapJsonZh)?l:null;return(0,n.jsx)("div",{className:"p-2 sm:p-3 lg:p-4 h-[62vh] min-h-[440px] max-h-[840px]",children:s?(0,n.jsx)(I,{data:s,themeMode:el}):(0,n.jsx)("div",{className:"h-full w-full flex items-center justify-center rounded-xl border border-dashed border-[var(--border-medium)] bg-[var(--paper-base)] px-6 text-center text-sm text-[var(--text-muted)] leading-7",children:J?"脑图正在生成中，请稍候...":"当前内容还没有脑图数据，可点击“重新处理文件”后生成。"})});default:return null}})()})]}),(0,n.jsx)("div",{className:"w-full self-start",children:eQ?(0,n.jsx)(N,{podcastId:t,enabled:eQ,panelHeight:en}):(0,n.jsx)("aside",{className:"dashboard-panel w-full min-h-[320px] rounded-2xl overflow-hidden flex flex-col justify-center px-5 text-sm text-[var(--text-secondary)]",style:"number"==typeof en&&en>0?{height:en}:void 0,children:"Copilot 会在当前文件处理完成后启用。"})})]})]}),(0,n.jsx)(()=>eR?(0,n.jsxs)("div",{className:"fixed bottom-0 right-0 w-80 max-h-80 overflow-auto bg-[var(--paper-base)] border border-[var(--border-medium)] rounded-tl-xl p-3 text-xs z-50 shadow-[0_16px_32px_-24px_rgba(80,67,44,0.5)]",children:[(0,n.jsxs)("h3",{className:"text-[var(--accent-strong)] font-semibold mb-2",children:["Debug Status v",E]}),(0,n.jsxs)("div",{className:"space-y-1 mb-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"ID:"})," ",(0,n.jsx)("span",{className:"text-[var(--text-main)]",children:t})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"State:"})," ",(0,n.jsx)("span",{className:"".concat(J?"text-amber-700":"text-emerald-700"),children:J?"PROCESSING":c?"LOADED":"IDLE"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)]",children:"Request Sent:"})," ",(0,n.jsx)("span",{className:"".concat(eE.current?"text-amber-700":"text-emerald-700"),children:eE.current?"YES":"NO"})]}),z&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-[var(--danger)]",children:"Error:"})," ",(0,n.jsx)("span",{className:"text-[var(--text-main)]",children:z})]})]}),(0,n.jsx)("h4",{className:"text-[var(--accent-strong)] font-semibold mt-2 mb-1",children:"Last Requests:"}),(0,n.jsx)("div",{className:"space-y-1 mb-2 max-h-20 overflow-y-auto",children:eU.networkRequests.slice(-3).reverse().map((e,t)=>(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-[var(--text-muted)] truncate",children:e.url.split("/").pop()}),(0,n.jsxs)("span",{className:"".concat(e.status<300?"text-emerald-700":"text-[var(--danger)]"),children:[e.status," (",e.duration,"ms)"]})]},t))}),(0,n.jsxs)("div",{className:"pt-2 border-t border-[var(--border-soft)] flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>eJ("refresh-clicked"),className:"text-xs bg-[var(--paper-subtle)] border border-[var(--border-soft)] text-[var(--text-secondary)] px-2 py-1 rounded hover:bg-[var(--paper-muted)]",children:"Refresh"}),(0,n.jsx)("button",{onClick:eq,className:"text-xs bg-[var(--paper-subtle)] border border-[var(--border-soft)] text-[var(--text-secondary)] px-2 py-1 rounded hover:bg-[var(--paper-muted)]",children:"Copy Debug Info"})]})]}):null,{}),(0,n.jsxs)("footer",{className:"p-4 text-center text-xs text-[var(--text-muted)] tracking-wide",children:["SRT Processor Edge Demo v",E]})]})})}},6033:(e,t,r)=>{Promise.resolve().then(r.bind(r,4586))},6344:(e,t,r)=>{"use strict";r.d(t,{S:()=>u,z:()=>d});let n=new Set(["the","and","for","with","from","that","this","into","about","over","your","you","are","was","were","will","how","what","why","when","they","them","their","our","ours","its","can","new","all","not","podcast","summary","video","talk","episode","analysis","transcript","public","private","full","text","part","chapter"]),a=new Set(["我们","你们","他们","这个","那个","一些","一个","一种","这样","那么","然后","因为","所以","就是","可以","需要","时候","问题","内容","总结","视频","播客","字幕","重点","分析","翻译"]);function l(e){return e.replace(/\s+/g," ").trim()}function s(e){return l(e).replace(/^#+/,"").replace(/[.,;:!?/\\|()[\]{}'"`]+$/g,"")}function o(e,t,r){let n=s(t);if(!n)return;let a=n.toLowerCase();e.set(a,(e.get(a)||0)+r)}function i(e,t,r,a){for(let l of t.match(/[A-Za-z][A-Za-z0-9+.-]{1,28}/g)||[]){let t=s(l),i=t.toLowerCase();t.length<2||n.has(i)||/^\d+$/.test(t)||(o(e,t,r),a&&!a.has(i)&&a.set(i,t))}}function c(e,t,r,n){for(let l of t.match(/[\u4e00-\u9fff]{2,10}/g)||[]){let t=s(l);if(t.length<2||a.has(t))continue;o(e,t,r);let i=t.toLowerCase();n&&!n.has(i)&&n.set(i,t)}}function d(e){let t=l(String(e.title||e.fallbackName||"")),r=l(String(e.summary||"").replace(/```[\s\S]*?```/g," ").replace(/`[^`]*`/g," ").replace(/!\[[^\]]*]\([^)]*\)/g," ").replace(/\[[^\]]*]\([^)]*\)/g," ").replace(/^#{1,6}\s+/gm,"").replace(/[*_~>#-]/g," ").replace(/\r\n/g,"\n")),n=new Map,a=new Map,d=e=>{let t=s(e);if(!t)return;let r=t.toLowerCase();a.has(r)||a.set(r,t)};for(let t of function(e){let t=String(e||"").toLowerCase(),r=[];return(t.includes("youtube.com")||t.includes("youtu.be"))&&r.push("YouTube"),t.includes("bilibili.com")&&r.push("Bilibili"),(t.includes("x.com")||t.includes("twitter.com"))&&r.push("X"),r}(e.sourceReference))o(n,t,8),d(t);t&&(i(n,t,5,a),c(n,t,5,a)),r&&(i(n,r,1,a),c(n,r,1,a));let u=Array.from(n.entries()).sort((e,t)=>t[1]-e[1]||e[0].localeCompare(t[0])).slice(0,10).map(e=>{let[t]=e;return a.get(t)||t}).map(e=>s(e)).filter(Boolean),m=[],p=new Set;for(let e of u){let t=e.toLowerCase();p.has(t)||(p.add(t),m.push(e))}return m}function u(e){let t=Array.isArray(e)?e:"string"==typeof e?(()=>{try{let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(t){return e.split(",").map(e=>e.trim()).filter(Boolean)}})():[],r=[],n=new Set;for(let e of t){let t=s(String(e||""));if(!t)continue;let a=t.toLowerCase();if(!n.has(a)&&(n.add(a),r.push(t),r.length>=10))break}return r}}},e=>{e.O(0,[2619,5239,1245,8441,1255,7358],()=>e(e.s=6033)),_N_E=e.O()}]);